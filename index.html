<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>ped_draw: pedigree drawing with ease</title>

  <link href="assets/ped_icon.png" rel="icon">

  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,600,600i,700,700i" rel="stylesheet">

  <link href="assets/bootstrap.min.css" rel="stylesheet">

  <link href="assets/style.css" rel="stylesheet">

 <!-- ped_draw -->
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

 <script type="text/javascript">
     $(document).ready(function () {
	     $('#fileUploader').on('change', handleFileSelect);
	 });
     function getPedImage() {
         pedText = $('#pedText').val().trim();
         pedText = pedText.replace(/ +/g, '\t');
         pedText = btoa(pedText);
         $.post(
             'https://alyg45jz31.execute-api.us-west-2.amazonaws.com/Prod/peddraw',
             {pedText: pedText},
             function (data){
	             if (data.sucess) {
                     document.getElementById('pedImg').setAttribute(
                         'src', data['image_data']
                     );
	             }
	             else {
	                 alert('An error occurred while processing your PED file, please check your PED file and try again');
	             }
             }
         );
     }

	 function loadTestPed() {
	     var testPed = '#Kindred_ID\tSample_ID\tPaternal_ID\tMaternal_ID\tSex\tAffected_Status\tProject\nK001\t1001\t1002\t1003\t1\t2\tdiseaseXYZ\nK001\t1002\t0\t0\t1\t1\tdiseaseXYZ\nK001\t1003\t0\t0\t2\t1\tdiseaseXYZ\nK001\t1004\t1001\t1006\t1\t1\tdiseaseXYZ\nK001\t1005\t1002\t1003\t1\t1\tdiseaseXYZ\nK001\t1006\t0\t0\t2\t1\tdiseaseXYZ\nK001\t1007\t1001\t1006\t2\t2\tdiseaseXYZ\nK001\t1008\t1001\t1006\t2\t1\tdiseaseXYZ';
	     $('#pedText').val(testPed);
	 }

	 function handleFileSelect(evt) {
	     // Check for the various File API support.
	     if (window.File && window.FileReader && window.FileList && window.Blob) {
	         var textFile = evt.target.files[0];
	         if (!escape(textFile.name).endsWith('.ped')) { alert('Wrong file type, please upload a ped file'); return; }
	         var fr = new FileReader();
	         fr.onload = function (e) {
	             $('#pedText').val(e.target.result);
	             setTimeout(getPedImage, 100);
	         }
	         fr.readAsText(textFile);
	     }
	     else {
	         alert('Your browser does not support loading files. Please update your browser and try again.');
	     }
	 }
 </script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162065745-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-162065745-1');
</script>

</head>

<body>

  <section id="hero" class="d-flex align-items-center">

    <div class="container">
      <div class="row">
        <div class="col-lg-6 pt-5 pt-lg-0 order-2 order-lg-1">
          <h1>Paste ped file:</h1>
             <textarea id="pedText" rows="15" cols="50"></textarea>
             <a href="#" class="btn-get-started scrollto" onclick="getPedImage()">Draw!</a> <a href="javascript:void(0)" onclick="loadTestPed()">Try an example</a>
        </div>
        <div class="col-lg-6 order-1 order-lg-2 hero-img">
		 <h1>Pedigree:</h1>
		 <img id="pedImg" src="" />
        </div>
      </div>
	  <br><br>
	  <h1>Upload ped file:</h1> 
	  <label for="fileUploader" class="custom-file-upload"><img src="assets/upload.png" height="20" width="20"> Browse
	  </label>
	  <input id="fileUploader" type="file"/>
	  <!-- <input type="file" id="fileUploader"/> --> <!--<a href="#" class="btn-get-started scrollto">Browse</a> -->
    </div>

  </section>
<br><br><br><br>
    <div class="container py-4">
      <div class="copyright">
        <span>
		  <img src="assets/github.png" width="35" height="35"></img>
		  <a href="https://github.com/mvelinder/ped_draw" target="_blank">ped_draw</a>, MIT-licensed, <a href="http://marthlab.org/" target="_blank">marthlab.org</a>, ped file <a href="https://gatkforums.broadinstitute.org/gatk/discussion/7696/pedigree-ped-files" target="_blank">specs</a></span>
      </div>
    </div>


</body>

</html>
